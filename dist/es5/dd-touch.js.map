{"version":3,"file":"dd-touch.js","sourceRoot":"","sources":["../../src/dd-touch.ts"],"names":[],"mappings":"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","sourcesContent":["/**\r\n * touch.ts 7.3.0\r\n * Copyright (c) 2021 Alain Dumesny - see GridStack root license\r\n */\r\n\r\nimport { DDManager } from './dd-manager';\r\n\r\n/**\r\n * Detect touch support - Windows Surface devices and other touch devices\r\n * should we use this instead ? (what we had for always showing resize handles)\r\n * /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)\r\n */\r\nexport const isTouch: boolean = typeof window !== 'undefined' && typeof document !== 'undefined' &&\r\n( 'ontouchstart' in document\r\n  || 'ontouchstart' in window\r\n  // || !!window.TouchEvent // true on Windows 10 Chrome desktop so don't use this\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  || ((window as any).DocumentTouch && document instanceof (window as any).DocumentTouch)\r\n  || navigator.maxTouchPoints > 0\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  || (navigator as any).msMaxTouchPoints > 0\r\n);\r\n\r\n// interface TouchCoord {x: number, y: number};\r\n\r\nclass DDTouch {\r\n  public static touchHandled: boolean;\r\n  public static pointerLeaveTimeout: number;\r\n}\r\n\r\n/**\r\n* Get the x,y position of a touch event\r\n*/\r\n// function getTouchCoords(e: TouchEvent): TouchCoord {\r\n//   return {\r\n//     x: e.changedTouches[0].pageX,\r\n//     y: e.changedTouches[0].pageY\r\n//   };\r\n// }\r\n\r\n/**\r\n * Simulate a mouse event based on a corresponding touch event\r\n * @param {Object} e A touch event\r\n * @param {String} simulatedType The corresponding mouse event\r\n */\r\nfunction simulateMouseEvent(e: TouchEvent, simulatedType: string) {\r\n\r\n  // Ignore multi-touch events\r\n  if (e.touches.length > 1) return;\r\n\r\n  // Prevent \"Ignored attempt to cancel a touchmove event with cancelable=false\" errors\r\n  if (e.cancelable) e.preventDefault();\r\n\r\n  const touch = e.changedTouches[0], simulatedEvent = document.createEvent('MouseEvents');\r\n\r\n  // Initialize the simulated mouse event using the touch event's coordinates\r\n  simulatedEvent.initMouseEvent(\r\n    simulatedType,    // type\r\n    true,             // bubbles\r\n    true,             // cancelable\r\n    window,           // view\r\n    1,                // detail\r\n    touch.screenX,    // screenX\r\n    touch.screenY,    // screenY\r\n    touch.clientX,    // clientX\r\n    touch.clientY,    // clientY\r\n    false,            // ctrlKey\r\n    false,            // altKey\r\n    false,            // shiftKey\r\n    false,            // metaKey\r\n    0,                // button\r\n    null              // relatedTarget\r\n  );\r\n\r\n  // Dispatch the simulated event to the target element\r\n  e.target.dispatchEvent(simulatedEvent);\r\n}\r\n\r\n/**\r\n * Simulate a mouse event based on a corresponding Pointer event\r\n * @param {Object} e A pointer event\r\n * @param {String} simulatedType The corresponding mouse event\r\n */\r\nfunction simulatePointerMouseEvent(e: PointerEvent, simulatedType: string) {\r\n\r\n  // Prevent \"Ignored attempt to cancel a touchmove event with cancelable=false\" errors\r\n  if (e.cancelable) e.preventDefault();\r\n\r\n  const simulatedEvent = document.createEvent('MouseEvents');\r\n\r\n  // Initialize the simulated mouse event using the touch event's coordinates\r\n  simulatedEvent.initMouseEvent(\r\n    simulatedType,    // type\r\n    true,             // bubbles\r\n    true,             // cancelable\r\n    window,           // view\r\n    1,                // detail\r\n    e.screenX,    // screenX\r\n    e.screenY,    // screenY\r\n    e.clientX,    // clientX\r\n    e.clientY,    // clientY\r\n    false,            // ctrlKey\r\n    false,            // altKey\r\n    false,            // shiftKey\r\n    false,            // metaKey\r\n    0,                // button\r\n    null              // relatedTarget\r\n  );\r\n\r\n  // Dispatch the simulated event to the target element\r\n  e.target.dispatchEvent(simulatedEvent);\r\n}\r\n\r\n\r\n/**\r\n * Handle the touchstart events\r\n * @param {Object} e The widget element's touchstart event\r\n */\r\nexport function touchstart(e: TouchEvent): void {\r\n  // Ignore the event if another widget is already being handled\r\n  if (DDTouch.touchHandled) return;\r\n  DDTouch.touchHandled = true;\r\n\r\n  // Simulate the mouse events\r\n  // simulateMouseEvent(e, 'mouseover');\r\n  // simulateMouseEvent(e, 'mousemove');\r\n  simulateMouseEvent(e, 'mousedown');\r\n}\r\n\r\n/**\r\n * Handle the touchmove events\r\n * @param {Object} e The document's touchmove event\r\n */\r\nexport function touchmove(e: TouchEvent): void {\r\n  // Ignore event if not handled by us\r\n  if (!DDTouch.touchHandled) return;\r\n\r\n  simulateMouseEvent(e, 'mousemove');\r\n}\r\n\r\n/**\r\n * Handle the touchend events\r\n * @param {Object} e The document's touchend event\r\n */\r\nexport function touchend(e: TouchEvent): void {\r\n\r\n  // Ignore event if not handled\r\n  if (!DDTouch.touchHandled) return;\r\n\r\n  // cancel delayed leave event when we release on ourself which happens BEFORE we get this!\r\n  if (DDTouch.pointerLeaveTimeout) {\r\n    window.clearTimeout(DDTouch.pointerLeaveTimeout);\r\n    delete DDTouch.pointerLeaveTimeout;\r\n  }\r\n\r\n  const wasDragging = !!DDManager.dragElement;\r\n\r\n  // Simulate the mouseup event\r\n  simulateMouseEvent(e, 'mouseup');\r\n  // simulateMouseEvent(event, 'mouseout');\r\n\r\n  // If the touch interaction did not move, it should trigger a click\r\n  if (!wasDragging) {\r\n    simulateMouseEvent(e, 'click');\r\n  }\r\n\r\n  // Unset the flag to allow other widgets to inherit the touch event\r\n  DDTouch.touchHandled = false;\r\n}\r\n\r\n/**\r\n * Note we don't get touchenter/touchleave (which are deprecated)\r\n * see https://stackoverflow.com/questions/27908339/js-touch-equivalent-for-mouseenter\r\n * so instead of PointerEvent to still get enter/leave and send the matching mouse event.\r\n */\r\nexport function pointerdown(e: PointerEvent): void {\r\n  // console.log(\"pointer down\")\r\n  (e.target as HTMLElement).releasePointerCapture(e.pointerId) // <- Important!\r\n}\r\n\r\nexport function pointerenter(e: PointerEvent): void {\r\n  // ignore the initial one we get on pointerdown on ourself\r\n  if (!DDManager.dragElement) {\r\n    // console.log('pointerenter ignored');\r\n    return;\r\n  }\r\n  // console.log('pointerenter');\r\n  simulatePointerMouseEvent(e, 'mouseenter');\r\n}\r\n\r\nexport function pointerleave(e: PointerEvent): void {\r\n  // ignore the leave on ourself we get before releasing the mouse over ourself\r\n  // by delaying sending the event and having the up event cancel us\r\n  if (!DDManager.dragElement) {\r\n    // console.log('pointerleave ignored');\r\n    return;\r\n  }\r\n  DDTouch.pointerLeaveTimeout = window.setTimeout(() => {\r\n    delete DDTouch.pointerLeaveTimeout;\r\n    // console.log('pointerleave delayed');\r\n    simulatePointerMouseEvent(e, 'mouseleave');\r\n  }, 10);\r\n}\r\n\r\n"]}